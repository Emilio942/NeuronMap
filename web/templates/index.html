{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Welcome Section -->
    <div class="col-12">
        <div class="hero-section text-center py-5 mb-5">
            <h1 class="display-4 text-primary">
                <i class="fas fa-brain me-3"></i>Welcome to NeuronMap
            </h1>
            <p class="lead">Advanced Neural Network Activation Analysis Platform</p>
            <p class="text-muted">
                Analyze, visualize, and compare neural network activations with cutting-edge tools and techniques.
            </p>
        </div>
    </div>
</div>

<!-- System Status Dashboard -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>System Status
                    <span class="badge bg-success ms-2" id="status-badge">Online</span>
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h3 class="text-primary mb-1" id="total-analyses">
                            <i class="fas fa-spinner fa-spin"></i>
                        </h3>
                        <small class="text-muted">Total Analyses</small>
                    </div>
                    <div class="col-md-3">
                        <h3 class="text-success mb-1" id="models-analyzed">
                            <i class="fas fa-spinner fa-spin"></i>
                        </h3>
                        <small class="text-muted">Models Analyzed</small>
                    </div>
                    <div class="col-md-3">
                        <h3 class="text-warning mb-1" id="layers-processed">
                            <i class="fas fa-spinner fa-spin"></i>
                        </h3>
                        <small class="text-muted">Layers Processed</small>
                    </div>
                    <div class="col-md-3">
                        <h3 class="text-info mb-1" id="visualizations-created">
                            <i class="fas fa-spinner fa-spin"></i>
                        </h3>
                        <small class="text-muted">Visualizations</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">
                    <i class="fas fa-clock me-2"></i>Recent Activity
                </h6>
                <small class="text-muted">Last updated: <span id="last-updated">--</span></small>
            </div>
            <div class="card-body p-0">
                <div id="recent-activities" style="max-height: 200px; overflow-y: auto;">
                    <div class="text-center p-3 text-muted">
                        <i class="fas fa-spinner fa-spin me-2"></i>Loading activities...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Feature Cards -->
<div class="row g-4 mb-5">
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 feature-card">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                <h5 class="card-title">Single Model Analysis</h5>
                <p class="card-text">Deep dive into individual model activations with comprehensive analysis tools.</p>
                <a href="{{ url_for('analysis') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-right me-1"></i>Start Analysis
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 feature-card">
            <div class="card-body text-center">
                <i class="fas fa-layer-group fa-3x text-success mb-3"></i>
                <h5 class="card-title">Multi-Model Comparison</h5>
                <p class="card-text">Compare activations across different models and architectures side by side.</p>
                <a href="{{ url_for('multi_model') }}" class="btn btn-outline-success">
                    <i class="fas fa-arrow-right me-1"></i>Compare Models
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 feature-card">
            <div class="card-body text-center">
                <i class="fas fa-chart-bar fa-3x text-warning mb-3"></i>
                <h5 class="card-title">Visualization Studio</h5>
                <p class="card-text">Create beautiful, interactive visualizations of neural network activations.</p>
                <a href="{{ url_for('visualization') }}" class="btn btn-outline-warning">
                    <i class="fas fa-arrow-right me-1"></i>Visualize
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 feature-card">
            <div class="card-body text-center">
                <i class="fas fa-brain fa-3x text-info mb-3"></i>
                <h5 class="card-title">Advanced Analytics</h5>
                <p class="card-text">Explore cutting-edge analysis techniques including attention flow and gradient attribution.</p>
                <a href="{{ url_for('advanced_analytics_page') }}" class="btn btn-outline-info">
                    <i class="fas fa-arrow-right me-1"></i>Advanced Tools
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h6 class="card-title mb-0">
                    <i class="fas fa-bolt me-2"></i>Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-primary w-100" onclick="quickAnalysis()">
                            <i class="fas fa-play me-2"></i>Quick Analysis
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('results') }}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-folder-open me-2"></i>Browse Results
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-outline-info w-100" onclick="showSystemInfo()">
                            <i class="fas fa-info-circle me-2"></i>System Info
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Model Explorer -->
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">
                    <i class="fas fa-search me-2"></i>Available Models
                </h6>
                <button class="btn btn-sm btn-outline-primary" onclick="refreshModels()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>
            <div class="card-body">
                <div id="model-list" class="row">
                    <div class="col-12 text-center text-muted">
                        <i class="fas fa-spinner fa-spin me-2"></i>Loading available models...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Dashboard functionality
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
    setInterval(loadDashboardData, 10000); // Refresh every 10 seconds
});

function loadDashboardData() {
    // Load system stats
    fetch('/api/stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-analyses').textContent = data.total_analyses || 0;
            document.getElementById('models-analyzed').textContent = data.models_analyzed || 0;
            document.getElementById('layers-processed').textContent = data.layers_processed || 0;
            document.getElementById('visualizations-created').textContent = data.visualizations_created || 0;
        })
        .catch(error => {
            console.error('Error loading stats:', error);
        });

    // Load recent activities
    fetch('/api/recent-activity')
        .then(response => response.json())
        .then(data => {
            const activitiesContainer = document.getElementById('recent-activities');
            if (data.activities && data.activities.length > 0) {
                activitiesContainer.innerHTML = data.activities.map(activity => `
                    <div class="border-bottom p-2">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-${activity.icon} text-${activity.color} me-2"></i>
                            <span class="flex-grow-1">${activity.message}</span>
                            <small class="text-muted">${activity.timestamp}</small>
                        </div>
                    </div>
                `).join('');
            } else {
                activitiesContainer.innerHTML = '<div class="text-center p-3 text-muted">No recent activities</div>';
            }
            
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
        })
        .catch(error => {
            console.error('Error loading activities:', error);
            document.getElementById('recent-activities').innerHTML = 
                '<div class="text-center p-3 text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error loading activities</div>';
        });

    // Load available models
    loadAvailableModels();
}

function loadAvailableModels() {
    fetch('/api/models')
        .then(response => response.json())
        .then(data => {
            const modelContainer = document.getElementById('model-list');
            if (data.models && data.models.length > 0) {
                modelContainer.innerHTML = data.models.slice(0, 6).map(model => `
                    <div class="col-md-4 col-lg-2 mb-3">
                        <div class="card border h-100 model-card" style="cursor: pointer;" onclick="analyzeModel('${model}')">
                            <div class="card-body text-center p-2">
                                <i class="fas fa-robot text-primary mb-2"></i>
                                <h6 class="card-title small mb-0">${model}</h6>
                            </div>
                        </div>
                    </div>
                `).join('') + (data.models.length > 6 ? 
                    '<div class="col-12 text-center"><small class="text-muted">... and ' + (data.models.length - 6) + ' more models</small></div>' : '');
            } else {
                modelContainer.innerHTML = '<div class="col-12 text-center text-muted">No models available</div>';
            }
        })
        .catch(error => {
            console.error('Error loading models:', error);
            document.getElementById('model-list').innerHTML = 
                '<div class="col-12 text-center text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error loading models</div>';
        });
}

function quickAnalysis() {
    // Redirect to analysis page with demo parameters
    window.location.href = '/analysis?demo=true';
}

function showSystemInfo() {
    // Show system information modal
    alert('System Info:\n\nNeuronMap v1.0\nFlask Web Interface\nAdvanced Analytics Enabled\nGPU Support: Auto-detected');
}

function refreshModels() {
    loadAvailableModels();
}

function analyzeModel(modelName) {
    // Quick analysis with selected model
    window.location.href = `/analysis?model=${encodeURIComponent(modelName)}`;
}
</script>

{% endblock %}
